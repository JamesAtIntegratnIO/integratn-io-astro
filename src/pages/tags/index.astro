---
import { getCollection } from "astro:content";
import TagsLayout from "../../layouts/TagsLayout.astro";
const allPosts = await getCollection("posts");
const tags: { tag: string; count: number }[] = allPosts.reduce(
  (acc: { tag: string; count: number }[], post) => {
    if (post.data && post.data.tags) {
      post.data.tags.forEach((tag) => {
        const existingTag = acc.find((t) => t.tag === tag);
        if (existingTag) {
          existingTag.count++;
        } else {
          acc.push({ tag, count: 1 });
        }
      });
    }
    return acc;
  },
  [],
);

const pageTitle = "Tag Index";
---

<TagsLayout title={pageTitle} tags={tags} />
